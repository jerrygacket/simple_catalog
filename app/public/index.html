<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Search</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
        }

        .config-section h2 {
            font-size: 18px;
            color: #495057;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        select[multiple] {
            min-height: 100px;
        }

        .filters-section {
            background: #fff;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: flex-end;
        }

        .filter-group input {
            flex: 1;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 18px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .results {
            margin-bottom: 30px;
        }

        .meta-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .meta-info span {
            color: #0c5460;
            font-size: 14px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .product-card {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            background: #fafafa;
        }

        .product-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .product-detail {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .facets {
            background: #fff3cd;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
        }

        .facets h3 {
            margin-bottom: 15px;
            color: #856404;
        }

        .facet-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .facet-item {
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
        }

        .facet-id {
            color: #495057;
            font-weight: 500;
        }

        .facet-count {
            color: #6c757d;
        }

        .pagination {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
<div id="app">
    <div class="container">
        <h1>üîç Product Search</h1>

        <div class="config-section">
            <h2>API Configuration</h2>
            <div class="input-group">
                <label>API Base URL</label>
                <input
                        v-model="apiUrl"
                        type="text"
                        placeholder="http://localhost:8087"
                />
            </div>
        </div>

        <div class="filters-section">
            <h2>Filters</h2>
            <div v-if="loadingOptions" style="padding: 20px; text-align: center; color: #6c757d;">
                Loading options...
            </div>
            <div v-else>
                <div
                        v-for="(filter, index) in filters"
                        :key="index"
                        class="filter-group"
                >
                    <div style="flex: 1;">
                        <label>Option</label>
                        <select v-model="filter.optionId">
                            <option value="">Select Option</option>
                            <option
                                    v-for="option in options"
                                    :key="option.id"
                                    :value="option.id"
                            >
                                {{ option.display_name }} (ID: {{ option.id }})
                            </option>
                        </select>
                    </div>
                    <div style="flex: 2;">
                        <label>Values (hold Ctrl/Cmd to select multiple)</label>
                        <select
                                v-model="filter.valueIds"
                                multiple
                                :disabled="!filter.optionId"
                        >
                            <option
                                    v-for="value in getOptionById(filter.optionId)?.values || []"
                                    :key="value.id"
                                    :value="value.id"
                            >
                                {{ value.value }} (ID: {{ value.id }})
                            </option>
                        </select>
                    </div>
                    <button
                            @click="removeFilter(index)"
                            class="btn btn-danger btn-small"
                    >
                        Remove
                    </button>
                </div>
                <button @click="addFilter" class="btn btn-secondary btn-small">
                    + Add Filter
                </button>
            </div>
        </div>

        <div class="input-group" style="max-width: 200px; display: inline-block; margin-right: 10px;">
            <label>Items per page</label>
            <input
                    v-model.number="count"
                    type="number"
                    min="1"
                    max="1000"
            />
        </div>

        <div class="controls">
            <button @click="search" class="btn btn-primary">
                Search Products
            </button>
            <button @click="clearFilters" class="btn btn-secondary">
                Clear Filters
            </button>
        </div>

        <div v-if="error" class="error">
            {{ error }}
        </div>

        <div v-if="loading" class="loading">
            Loading...
        </div>

        <div v-if="!loading && response" class="results">
            <div class="meta-info">
                <span><strong>Total:</strong> {{ response.meta.total_count }} products</span>
                <span><strong>Page:</strong> {{ response.meta.current_page + 1 }} / {{ response.meta.total_pages }}</span>
                <span><strong>Showing:</strong> {{ response.meta.count }} items</span>
            </div>

            <div v-if="response.products.length === 0" class="empty-state">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <h3>No products found</h3>
                <p>Try adjusting your filters</p>
            </div>

            <div v-else class="products-grid">
                <div
                        v-for="product in response.products"
                        :key="product.product_id"
                        class="product-card"
                >
                    <h3>Product #{{ product.product_id }}</h3>
                    <div class="product-detail">
                        <strong>Option IDs:</strong> {{ product.option_ids.join(', ') || 'None' }}
                    </div>
                    <div class="product-detail">
                        <strong>Option Value IDs:</strong> {{ product.option_value_ids.join(', ') || 'None' }}
                    </div>
                </div>
            </div>

            <div class="pagination">
                <button
                        @click="goToPage(0)"
                        :disabled="currentPage === 0"
                        class="btn btn-secondary btn-small"
                >
                    First
                </button>
                <button
                        @click="goToPage(currentPage - 1)"
                        :disabled="currentPage === 0"
                        class="btn btn-secondary btn-small"
                >
                    Previous
                </button>
                <span style="padding: 0 15px;">
                        Page {{ currentPage + 1 }} of {{ response.meta.total_pages }}
                    </span>
                <button
                        @click="goToPage(currentPage + 1)"
                        :disabled="!response.meta.next_page"
                        class="btn btn-secondary btn-small"
                >
                    Next
                </button>
                <button
                        @click="goToPage(response.meta.total_pages - 1)"
                        :disabled="currentPage === response.meta.total_pages - 1"
                        class="btn btn-secondary btn-small"
                >
                    Last
                </button>
            </div>

            <div v-if="Object.keys(response.facets).length > 0" class="facets">
                <h3>üìä Facets (Option Value IDs)</h3>
                <div class="facet-list">
                    <div
                            v-for="(count, valueId) in response.facets"
                            :key="valueId"
                            class="facet-item"
                    >
                        <span class="facet-id">ID: {{ valueId }}</span>
                        <span class="facet-count">{{ count }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                apiUrl: 'http://localhost:8087',
                filters: [
                    { optionId: '', valueIds: [] }
                ],
                count: 10,
                currentPage: 0,
                loading: false,
                error: null,
                response: null,
                options: [],
                loadingOptions: false
            };
        },
        methods: {
            addFilter() {
                this.filters.push({ optionId: '', valueIds: [] });
            },
            removeFilter(index) {
                this.filters.splice(index, 1);
                if (this.filters.length === 0) {
                    this.addFilter();
                }
            },
            clearFilters() {
                this.filters = [{ optionId: '', valueIds: [] }];
                this.currentPage = 0;
                this.response = null;
                this.error = null;
            },
            getOptionById(optionId) {
                return this.options.find(opt => opt.id === parseInt(optionId));
            },
            async loadOptions() {
                this.loadingOptions = true;
                try {
                    const response = await fetch(`${this.apiUrl}/options`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    this.options = await response.json();
                } catch (err) {
                    this.error = `Error loading options: ${err.message}`;
                } finally {
                    this.loadingOptions = false;
                }
            },
            buildUrl() {
                const params = new URLSearchParams();

                // Add filters
                this.filters.forEach(filter => {
                    if (filter.optionId && filter.valueIds.length > 0) {
                        params.append(`filters[${filter.optionId}]`, filter.valueIds.join(','));
                    }
                });

                // Add pagination
                params.append('page', this.currentPage);
                params.append('count', this.count);

                return `${this.apiUrl}/products?${params.toString()}`;
            },
            async search() {
                this.loading = true;
                this.error = null;

                try {
                    const url = this.buildUrl();
                    const response = await fetch(url);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    this.response = await response.json();
                } catch (err) {
                    this.error = `Error: ${err.message}. Make sure the API is running and CORS is enabled.`;
                    this.response = null;
                } finally {
                    this.loading = false;
                }
            },
            async goToPage(page) {
                this.currentPage = page;
                await this.search();
            }
        },
        mounted() {
            this.loadOptions();
        }
    }).mount('#app');
</script>
</body>
</html>